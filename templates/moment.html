{% extends "base.html" %}
{% block title %}A Path Moment{% endblock %}
{% block head %}
	{{ super() }}
	<script src="http://js.pusher.com/1.11/pusher.min.js"></script>
	<script type="text/javascript">
		// don't include this in production
		Pusher.log = function(message) {
			if (window.console && window.console.log) window.console.log(message);
		};
		WEB_SOCKET_DEBUG = true;
		// remove the above in production
	
		var pusher = new Pusher('5b7cb63a557f941ee1aa');
		var channel = pusher.subscribe('a_channel');
		channel.bind('an_event', function(data) {
			var list = document.getElementById('list_of_moments');
			var the_elements = list.children;
			var new_element = document.createElement('li');
			//new_element.innerHTML = "<img src=\"" + "http://ecstartupsummit.com/img/logo.png" + "\">";
			new_element.innerHTML = "<img src=\"" + data['photo_url'] + "\" width=\"250\" height=\"250\" id=\"" + data['id'] + "\" />";
			var el_already_in_list = document.getElementById(data['id']);
			console.log(el_already_in_list);
			if (el_already_in_list == null) {
				list.insertBefore(new_element, list.firstChild);
			}
			//alert(data['photo_url']);
		});
	</script>
{% endblock %}
{% block content %}
	<div class="photo-moments">
		<ul id="list_of_moments">
			{% for moment in photo_moments %}
				{% if moment.getPhotoUrl() %}
				<li><img src="{{moment.getPhotoUrl()}}" width="250" height="250" id="{{moment.getId()}}" /></li>
				{% endif %}
			{% else %}
				<li>Sorry! No moments found.</li>
			{% endfor %}
		</ul>
	</div>
	<h2>Here is are recent tweeted moments</h2>
	<ul class="moment-tweets">
	{% for moment in photo_moments %}
		<li>{{ moment.getText() }}</li>
	{% else %}
		<li>Sorry! No moments found.</li>
	{% endfor %}
	</ul>
{% endblock %}
